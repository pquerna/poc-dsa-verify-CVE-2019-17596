#!/bin/bash

set -ex

idfile=$(mktemp /tmp/foo.XXXXXXXXX)

docker build --iidfile ${idfile} .

buildid=`cat ${idfile}`

function cleanup {
  docker rmi ${buildid}
  rm -f "${idfile}"
}
trap cleanup EXIT

docker run --rm ${buildid} go test -mod=vendor -v -run TestDSAVerify
docker run --rm ${buildid} go test -mod=vendor -v -run TestSSHClientHostKey

